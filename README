# Automated-ASR
This is a python code that automates the workflow of Ancestral Sequence Reconstruction. Learning how to do ASR well is time consuming, as is actually doing ASR, so this code is designed to be used by labs who have no expeirence with ASR and by labs who use ASR all the time, but may have more sequences they're interested in exploring than they can handle manually. This script should take the active time for an ASR run down to less than 5 minutes once it's set up.
So if you want to know about the evoloutionary history of a protein of interest or if you just want a new starting point for directed evoloution, ancestral proteins can be more accessable than ever before.
Additionally, AutoASR will provide DNA libraries for all the ancestral proteins that are reconstructed so that you can take full advantage of the uncertianty in the ancestral seqeucne and test a whole library of potentially useful proteins.
To see more about how the code works, run this python with the -help option, or look at the bottom of this README.
Some lines may need to be changed to reflect the executable names in your system for IQTree, MAFFT, and CD-Hit.
When downloading this software to use for your own analysis, it will be nessecary to do a little setup:
  Rename the directory to somehthing that is memorable and that is not already a directory in the same workspace as this software. Its current form WILL overwrite existing directories.
  Be sure that CD-Hit, MAFFT, and IQ-Tree are installed, and their executables have been added to the $PATH such that the executable lines will run.
      CD-Hit: https://github.com/weizhongli/cdhit 
      MAFFT: https://mafft.cbrc.jp/alignment/software/
      IQ-TREE: http://www.iqtree.org/#download
  The Biopython module will need to be installed. The MatPlotLib module is optional.
  If you have any questions, feel free to reach out - my email is in the header of the python file.

AutoASR is written fully in Python, and is a sereis of function calls for each task or step in the ASR process. I know this is written at the level of a first-year undergraduate, which is because I wrote this when I was a first-year undergraduate. If you have style tips, I'm all ears.



This software automates the process of ancestral sequence reconstruction. This software has one required input option and two optional input parameters.
     The first input in the name of the FASTA file containing the input sequence(s) or the input sequence itself.
     The second and third input are optional, but must be entered together. 
     The second input is the desired number of final sequences in the ASR. It must be a whole number greater than 20; the actual number of final sequences may vary. Default is 500 sequences.
     The third input is the sequence suppliment similarity cutoff. This represents the threshold below which sequences will be supplimented to fill out sequence space. It must be a number between 0.4 and 0.9. Default is 0.7.
Options should be entered on the command line in the form
     python AutoASR.py {input.fasta} {Number of Desired Sequences} {Sequence Suppliment Cutoff}
Entering just the option "help" or "h" will display this description. 


This AutoASR script makes use of external software, which must be set up before it can be used. See the GitHub page for this project (github.com/jjvanantwerp/Automated-ASR) for download links. 
This software requires IQTree 2, CD-Hit, and MAFFT to be downloaded and set up with their standard executable names added to the path. 
It also requires the python modules BioPython (Bio) and xml to be installed. Optionally, the python module matplotlib can be installed for production of figures from the data.



The program will make the following directory structure, where ROOT is the directory the script is placed in:
    ROOT/
    |--AutoASR.py                             This script
    |--Input.fasta                            The input fasta file, if you used one.
    |--ASR/...................................The directory containing all work from the most recent run. The software WILL overwrite old runs.
    | |--BlastP_XML_                                The raw XML returned by NCBI's BlastP, if you want to find more information about the BlastP resutls.
    | |--HitsInfo.csv                               Data about the BlastP hits - Sequence IDs and notes.
    | |--CD-Hit_Inital_Sequences.fasta.clstr        Residual from CD-Hit.
    | |--Sequence_Supplement/.......................The directory for the files created by adding additional sequence data to poorly supported regions of the tree. It's not always used.
    | | |--*__Suppliment_HitsInfo.csv                   Same as HitInfo.csv, but for each suppliment.
    | | |--*_BlastP_Results.fasta                       Each top 50 hits from sequences that are supplimented.
    | |--Final_Sequences.fasta                      The set of moderns equences used for the ASR and the foundation of all the later calculation
    | |--IQTree_Phylo/..............................The directory for IQTree files from the phylogoney.
    | | |--Phylo.*                                      All IQTree files.
    | | |--Supports.*                                   Data about the confidence of tree topology - .csv holds all data, .txt is summary.
    | | |--UFB_Confidences.png                          Histogram of UFB node support values.
    | | |--SHaLRT_Confidences.png                       Histogram of SHaLRT node support values
    | |--IQTree_ASR/................................The directory for IQTree files from ASR.
    | | |--ASR.*                                        All IQTree files.
    | | |--Confidences.*                                Data about the confidence of ASR prediction - .csv holds all data, .txt is summary, .png is a histogram.
    | |--IQTree_Binary/.............................The directory for IQTree files from gap analysis.
    | | |--Binary_Alignment.fasta                       A binary alinment of modern sequences - gap or not.
    | | |--Binary.*                                     All IQTree files.
    | |--DNA_Library_12.5%_Cutoff.fasta.fasta/      Fasta of DNA for all high-confidence ancestors, with degenerate codons coding for all AAs with more than a 1/8 likelihood.
    | |--Concesus_Ancestors_with_Gaps.fasta         The set of likely ancestors, aligned and with gaps where the binary gap analysis predicts them.
    | |--Final_Tree.treefile                        The final tree which is best for reading, as it has the most information in one place.
